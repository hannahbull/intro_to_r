---
title: "Class 3: Writing LaTeX articles and making websites using R Markdown"
output:
  html_document:
    number_sections: true
    theme: cosmo
    code_folding: hide
---
  
<style>
  body {background-color:lavender}
</style>
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require("tidyverse")
```

# Pre-class preparation

## Download MiKTeX or TexLive

You will need to download MiKTeX or TexLive for this class.

Windows: MiKTeX (Complete) - http://miktex.org/2.9/setup
(NOTE: Be sure to download the Complete rather than Basic installation)

Mac OS X: TexLive 2013 (Full) - http://tug.org/mactex/
(NOTE: Downloading with Safari rather than Chrome is strongly recommended)

Linux: `sudo apt-get install texlive-full`

## Test that you can create a pdf R Markdown file

1. Install package `knitr` (command `install.packages("knitr")`) 
2. Click File -> New File -> R Markdown 
3. Choose PDF output 

![Choose PDF output](Data/images/rmarkdown.png)  

4. Save file (file extension is .rmd)
5. Click `Knit` (at the top of the window)  

![Click Knit](Data/images/knit.png)  


6. You should then see a pdf file open. If not, read the error messages and try to resolve the problem. We are also here to help!  

## Supplementary instructions if the former does not work (Windows)

1. Install the package `devtools` 

2. Run: `devtools::install_github('yihui/tinytex')` 

3. Open the MikTeX Console (find it in the search bar), and in settings select 'always install packages on the fly'

# Today's exercise

We will learn the how to write down any type of document (homework, paper, slides, etc...) using Rmarkdown.  

# Set-up

Our aim for today is to learn how to write a document that contains tables and graphs that you created in R.

## Installing packages 

In order to create a document using Rmarkdown, you will need to install `knitr`. 
Do not forget to load the package once it's installed.

```{r packages, warning=FALSE, message=FALSE, error=FALSE}
list.of.packages <- c("tidyverse", "knitr", "haven")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages, repos = "http://cran.us.r-project.org")

invisible(lapply(list.of.packages, library, character.only = TRUE))
```


# Choosing the document type

Your document should start with those 4 lines:

```
---
title: "Title"
author: "First Name Name"
date: "September 10th, 2018"
output: pdf_document
---
```

The "output" line allows you to choose the document type. Here are the most commonly used document types:
* pdf_document produces a pdf file
* word_document produces a word file
* beamer_presentation produces a beamer document, i.e. slides compiled with LaTeX
* html_document produces an html file

# Plain text

You can structure your document with different sections and subsection using the # sign:

```
# Section
## Subsection
### Subsubsection
etc
```

You can then write your text as plain text. Here are a few useful commands that you can use to format your text.

Symbol      | Effect
------------- | -----------------------------------------------------------------------------------------------------------------
```*italics*```     | *italics* 
```**bold**```      | **bold** 
```exponent^2^```   | exponent^2^
```[link to Course website](https://introtor-pse.appspot.com/) ``` | [link to Course website](https://introtor-pse.appspot.com/)
```$y = \alpha + \beta x + \epsilon$``` | $y = \alpha + \beta x + \epsilon$


# Code chunks

The main advantage of using Rmarkdown is that you can include in your document pieces of code that might or might not be evaluated by R. These pieces of code are called Code chunks.

Here is how you can create a code chunk:

````r
`r ''````{r}
Write R your code here.
```
````

Within the {}, you can specify in which software's syntax you're writing your code (in your case, this is always going to be R) as well as a set of options for your Code chunk. The syntax is hence ```{r, options} ```.
 
The code options are:
 
Option | Effect 
----------| -------------------------------------------------------------------------------
eval = FALSE |  knitr will not run the code in the code chunk
include = FALSE |  knitr will run the chunk but not include the chunk in the final document
echo = FALSE |  knitr will not display the code in the code chunk above it’s results in the final document

The results options are:

Option | Effect 
----------| -------------------------------------------------------------------------------
results = 'hide' | knitr will not display the code’s results in the final document
results = 'hold' | knitr will delay displaying all output pieces until the end of the chunk 
warning = FALSE | knitr will not display any warning messages generated by the code
message = FALSE | knitr will not display any messages generated by the code

Let's load our data. Since we do not want this code chunk to appear in the final document, we are going to use the ```include = FALSE``` option. 

````r
`r ''````{r, include = FALSE}
df <- read_csv(dataframe) # you might use a different function depending on your file format.
```
````

```{r, include = FALSE}
df <- read_dta("Data/Score_US.dta")
```

## Inline code

```{r, include = FALSE}
myvalue=42
```

Say we have predefined an object `myvalue=42`. In order to display this value in the text, use `'r myvalue'` to print `r myvalue`. 

# Tables

## Make your table manually

```
Row names | Values 
----------| ------
Row 1     | Value 1
Row 2     | Value 2
```


Row names | Values 
----------| ------
Row 1     | Value 1
Row 2     | Value 2

## Insert an R table


You can insert an R table to your document using the ```kable``` function.
Let's create a table containing summary statistics of two variables of your choice. The variables should be in rows and the different summary statistics (mean, sd, min, max) in columns. Remember that we want R to evaluate the code without displaying the code and its result in the document.

```{r, include = FALSE}

table1 <- df %>%
          summarise(Mean = mean(X4RSCALK1,na.rm = T),
                    SD = sd(X4RSCALK1, na.rm = T),
                    Min = min(X4RSCALK1, na.rm = T),
                    Max = max(X4RSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Reading") %>%
                    select(Variable, Mean:Max)
table2 <- df %>%
          summarise(Mean = mean(X4MSCALK1,na.rm = T),
                    SD = sd(X4MSCALK1, na.rm = T),
                    Min = min(X4MSCALK1, na.rm = T),
                    Max = max(X4MSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Maths") %>%
                    select(Variable, Mean:Max)

table <- rbind(table1,table2)

```

````r
`r ''````{r, include = FALSE}
table1 <- df %>%
          summarise(Mean = mean(X4RSCALK1,na.rm = T),
                    SD = sd(X4RSCALK1, na.rm = T),
                    Min = min(X4RSCALK1, na.rm = T),
                    Max = max(X4RSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Reading") %>%
                    select(Variable, Mean:Max)
table2 <- df %>%
          summarise(Mean = mean(X4MSCALK1,na.rm = T),
                    SD = sd(X4MSCALK1, na.rm = T),
                    Min = min(X4MSCALK1, na.rm = T),
                    Max = max(X4MSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Maths") %>%
                    select(Variable, Mean:Max)

table <- rbind(table1,table2)
```
````

Let's now output this table to our document:
````r
`r ''````{r}
kable(df[1:5,1:4 ], caption = 'This is my caption')
```
````

```{r, echo = FALSE}
kable(table, caption = 'This is my caption')
```

## Make regression tables

You can use the 

# Insert Figures

## Insert figures from a folder

```
![Caption for the picture.](/path/to/image.pdf)
```

## Insert R figures

Try to insert the distribution of the variable of your choice to the document. Make sure no unintended message will be output to the document, and center the figure using the `fig.align='center'`option.


````r
`r ''````{r , fig.width = 5, fig.height = 4, warning = FALSE, echo = FALSE, error = FALSE, message = FALSE, fig.align='center'}
ggplot(data = df, aes(x = df$X4RSCALK1)) + 
      geom_density() + 
      theme_classic() + 
      labs(x = "Reading score") 
```
````

```{r, fig.width = 5, fig.height = 4, warning = FALSE, echo = FALSE, error = FALSE, message = FALSE, fig.align='center'} 
ggplot(data = df, aes(x = df$X4RSCALK1)) + 
      geom_histogram() + 
      theme_classic() + 
      labs(x = "Reading score") 
```



