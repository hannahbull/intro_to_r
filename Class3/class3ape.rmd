---
title: "Class 3: Writing reproducible articles using R Markdown"
output:
  html_document:
    number_sections: true
    theme: cosmo
    code_folding: hide
---
  
<style>
  body {background-color:lavender}
</style>
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require("tidyverse")
require("knitr")
require("haven")
require("stargazer")

```

# Pre-class preparation

## Download MiKTeX or TexLive

You will need to download MiKTeX or TexLive for this class.

Windows: MiKTeX (Complete) - http://miktex.org/2.9/setup
(NOTE: Be sure to download the Complete rather than Basic installation)

Mac OS X: TexLive 2013 (Full) - http://tug.org/mactex/
(NOTE: Downloading with Safari rather than Chrome is strongly recommended)

Linux: `sudo apt-get install texlive-full`

## Test that you can create a pdf R Markdown file

1. Install package `knitr` (command `install.packages("knitr")`) 
2. Click File -> New File -> R Markdown 
3. Choose PDF output 

![Choose PDF output](Data/images/rmarkdown.png)  

4. Save file (file extension is .rmd)
5. Click `Knit` (at the top of the window)  

![Click Knit](Data/images/knit.png)  


6. You should then see a pdf file open. If not, read the error messages and try to resolve the problem. We are also here to help!  

# Today's exercise

We will learn how to create any type of document (homework, paper, slides, etc…) in any format (PDF, html, beamer) using Rmarkdown. The main advantage of Rmarkdown is that it allows you to create a single document that includes both your text and your code.

This document can then be **knitted** : you can tell R to convert your document to the format of your choice. When doing so, R reads the plain text of your document, but also evaluates the code chunks that you have included in your document. You have at your disposal a bunch of options that allow you to tell R whether the R output and code should be displayed in the final document or not.

To see an example of the homework exercise, which is the goal of today's lesson, [click here](https://introtor-pse.appspot.com/class3examplehomework.pdf).

# Set-up

Our aim for today is to learn how to write a document that contains tables and graphs that you created in R.


## Reading the data

The data for today’s exercise can be downloaded from [here](https://drive.google.com/drive/u/1/folders/1jFcN7nzdc1J34_3koopHswNgSxXBTDU_).

## Opening an R markdown file 

In order to open an Rmarkdown file, you can click on the **+** sign below the **File** tab that you usually use to open an R script. This time, you can select R Markdown. A window appears, where you can write down the name of your document and choose its type (PDF, html…). If you did not manage to install LaTeX on your computer before the session, select the html option.

## Choosing the document type

Your document should start with this 4 lines:

```
---
title: "Title"
author: "First Name Last Name"
date: "September 10th, 2018"
output: pdf_document
---
```

The "output" line allows you to choose the document type. Here are the most commonly used document types:
* pdf_document produces a pdf file
* word_document produces a word file
* beamer_presentation produces a beamer document, i.e. slides compiled with LaTeX
* html_document produces an html file

## Installing packages 

In order to create a document using Rmarkdown, you will need to install `knitr` and `stargazer`. 

```{r packages, warning=FALSE, message=FALSE, error=FALSE}
list.of.packages <- c("tidyverse", "knitr", "haven", "stargazer")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages, repos = "http://cran.us.r-project.org")
```

In the set-up code chuck, add `require("tidyverse")`, `require("knitr")` etc. to use the packages. 

# Plain text

You can structure your document with different sections and subsection using the # sign:

```
# Section
## Subsection
### Subsubsection
etc
```

You can then write your text as plain text. Here are a few useful commands that you can use to format your text.

Symbol      | Effect
------------- | -----------------------------------------------------------------------------------------------------------------
```*italics*```     | *italics* 
```**bold**```      | **bold** 
```exponent^2^```   | exponent^2^
```[link to Course website](https://introtor-pse.appspot.com/) ``` | [link to Course website](https://introtor-pse.appspot.com/)
```$y = \alpha + \beta x + \epsilon$``` | $y = \alpha + \beta x + \epsilon$


# Code chunks

The main advantage of using Rmarkdown is that you can include in your document pieces of code that might or might not be evaluated by R. These pieces of code are called Code chunks.

Here is how you can create a code chunk:

````r
`r ''````{r}
Write R your code here.
```
````

Within the {}, you can specify in which software's syntax you're writing your code (in your case, this is always going to be R) as well as a set of options for your Code chunk. The syntax is hence ```{r, options} ```.
 
The code options are:
 
Option | Effect 
----------| -------------------------------------------------------------------------------
eval = FALSE |  knitr will not run the code in the code chunk
include = FALSE |  knitr will run the chunk but not include the chunk in the final document
echo = FALSE |  knitr will not display the code in the code chunk above it’s results in the final document

The results options are:

Option | Effect 
----------| -------------------------------------------------------------------------------
results = 'hide' | knitr will not display the code’s results in the final document
results = 'hold' | knitr will delay displaying all output pieces until the end of the chunk 
warning = FALSE | knitr will not display any warning messages generated by the code
message = FALSE | knitr will not display any messages generated by the code

Let's load our data. Since we do not want this code chunk to appear in the final document, we are going to use the ```include = FALSE``` option. 

````r
`r ''````{r, include = FALSE}
df <- read_csv(dataframe) # you might use a different function depending on your file format.
```
````

```{r, include = FALSE}
df <- read_dta("Data/Score_US.dta")
```

## Inline code

```{r, include = FALSE}
myvalue=42
```

Say we have predefined an object `myvalue=42`. In order to display this value in the text, use ` ` r myvalue ` ` to print `r myvalue`. 

# Tables

There are two ways to output tables in your final document:

- write down the table manually in the plain text of your Rmarkdown document 

- output a table that you have created in your R code 


## Make your table manually

Type this as plain text:

```
Row names | Values 
----------| ------
Row 1     | Value 1
Row 2     | Value 2
```

It should look like this: 

Row names | Values 
----------| ------
Row 1     | Value 1
Row 2     | Value 2

## Insert an R table


You can insert an R table to your document using the `kable` function. The syntax is as follows: `kable(table_name, options)`. Here are the most useful options of the `kable` function:

Option |	Effect
--------------------------------- | ------------------------------
align = c(“l”,“c”,“c”,“c”) |	First column will be aligned to the left, second to fourth columns will be centered
col.names = c(“Name 1”, “Name 2”, “Name 3”, “Name 4”) |	Defines the columns headers

Try to create a table containing some summary statistics for two variables of your choice. The variables should be in rows and the different summary statistics (mean, sd, min, max) in columns. Remember that we want R to evaluate the code without displaying the code and its result in the document.

```{r, include = FALSE}

table1 <- df %>%
          summarise(Mean = mean(X4RSCALK1,na.rm = T),
                    SD = sd(X4RSCALK1, na.rm = T),
                    Min = min(X4RSCALK1, na.rm = T),
                    Max = max(X4RSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Reading") %>%
                    select(Variable, Mean:Max)
table2 <- df %>%
          summarise(Mean = mean(X4MSCALK1,na.rm = T),
                    SD = sd(X4MSCALK1, na.rm = T),
                    Min = min(X4MSCALK1, na.rm = T),
                    Max = max(X4MSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Maths") %>%
                    select(Variable, Mean:Max)

table <- rbind(table1,table2)

```

````r
`r ''````{r, include = FALSE}
table1 <- df %>%
          summarise(Mean = mean(X4RSCALK1,na.rm = T),
                    SD = sd(X4RSCALK1, na.rm = T),
                    Min = min(X4RSCALK1, na.rm = T),
                    Max = max(X4RSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Reading") %>%
                    select(Variable, Mean:Max)
table2 <- df %>%
          summarise(Mean = mean(X4MSCALK1,na.rm = T),
                    SD = sd(X4MSCALK1, na.rm = T),
                    Min = min(X4MSCALK1, na.rm = T),
                    Max = max(X4MSCALK1,na.rm = T)) %>%
                    mutate(Variable = "Maths") %>%
                    select(Variable, Mean:Max)

table <- rbind(table1,table2)
```
````

Let’s now output this table to our document. Since we do not want to output the code to our document, we are going to use the echo= FALSE option:

````r
`r ''````{r}
kable(table, caption = 'This is my caption')
```
````

```{r, echo = FALSE}
kable(table, caption = 'This is my caption')
```

## Make regression tables

You can use the R package `stargazer` to make nice tables, specifically regression tables. 

For example, you can use `stargazer(table)` to produce a latex table of the previous table we created, or you can easily create a table of a regression. See [the package documentation](https://cran.r-project.org/web/packages/stargazer/vignettes/stargazer.pdf) for more details. You will need to use `results='asis'` in the options for the code chuck in order for the table to appear. 

```{r, results="hide"}
linear.1 <- lm(X1RSCALK1 ~ X1MSCALK1, data=df)
stargazer(linear.1,  header=FALSE, type='latex')
```

# Insert Figures

## Insert figures from a folder

```
![Caption for the picture.](/path/to/image.pdf)
```

## Insert R figures

Try to insert the distribution of the variable of your choice to the document. Make sure no unintended message will be output to the document, and center the figure using the `fig.align='center'`option.


````r
`r ''````{r , fig.width = 5, fig.height = 4, warning = FALSE, echo = FALSE, error = FALSE, message = FALSE, fig.align='center'}
ggplot(data = df, aes(x = df$X4RSCALK1)) + 
      geom_density() + 
      theme_classic() + 
      labs(x = "Reading score") 
```
````

```{r, fig.width = 5, fig.height = 4, warning = FALSE, echo = FALSE, error = FALSE, message = FALSE, fig.align='center'} 
ggplot(data = df, aes(x = df$X4RSCALK1)) + 
      geom_histogram() + 
      theme_classic() + 
      labs(x = "Reading score") 
```


# Add a bibliography to the document

In order to add a bibliography to the end of your document, you first need to create a .bib file in LaTeX that contains the list of references that you want to cite in BibTeX format.

In order to obtain the BibTeX references of the paper, you can search for the paper in Google Scholar and select the “” sign. Then, click on BibTeX and copy and paste the reference to your .bib file.

Then, add a line specifying the .bib file name to the Preamble:

`bibliography: biblio.bib`

You should insert the reference as follows, in you text:

Blablabla, as was shown by @reference_name.

This will result in:

- a sentence that looks like this: Blablabla, as was shown by Author name (review year)
- the full reference at the end of your document


# Exercise

Using the dataset of your choice, create an article template including: 

- Headings and subheadings

- Some text (lorem ipsum)

- A summary statistics table

- A ggplot

- A regression table with one simple regression 

- An inline value incorporated in the text

- A mathematical formula in the text

- A bibliography with at least 2 references


**The article does not need to make sense!**

Upload your PDF file [here](https://www.dropbox.com/request/M4Cl3CbVynlmldgCt4g9).
